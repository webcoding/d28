webpackJsonp([50],{TdIe:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=s("mvHQ"),a=s.n(n),o=s("cdA+"),i=s("0xDb"),r={data:function(){return{updatePassowrdVisible:!1,unReadMsg:"",websocket:null,wsData:"",kefuVisible:!1,onLine:[],msg:"",to:[]}},components:{UpdatePassword:o.default},computed:{navbarLayoutType:{get:function(){return this.$store.state.common.navbarLayoutType}},sidebarFold:{get:function(){return this.$store.state.common.sidebarFold},set:function(t){this.$store.commit("common/updateSidebarFold",t)}},mainTabs:{get:function(){return this.$store.state.common.mainTabs},set:function(t){this.$store.commit("common/updateMainTabs",t)}},userName:{get:function(){return this.$store.state.user.name}}},mounted:function(){this.initWebSocket()},beforeDestroy:function(){this.onbeforeunload()},methods:{openKefu:function(){this.kefuVisible=!this.kefuVisible,this.unReadMsg=""},sendAll:function(){if(this.msg){var t={msg:this.msg,type:1},e=a()(t);this.websocket.send(e)}else this.$message.error("发送内容不能为空")},sendToUser:function(){if(this.msg)if(0===this.to.length)this.$message.error("请选择一个用户");else{var t={to:this.to,msg:this.msg,type:2},e=a()(t);this.websocket.send(e)}else this.$message.error("发送内容不能为空")},updatePasswordHandle:function(){var t=this;this.updatePassowrdVisible=!0,this.$nextTick(function(){t.$refs.updatePassowrd.init()})},logoutHandle:function(){var t=this;this.$confirm("确定进行[退出]操作?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.$http({url:"/sys/logout",method:"post"}).then(function(e){var s=e.data;s&&0===s.code&&(Object(i.a)(),t.$router.push({name:"login"}))})}).catch(function(){})},initWebSocket:function(){},setErrorMessage:function(){this.wsData+="WebSocket连接发生错误   状态码："+this.websocket.readyState},setOnopenMessage:function(){console.log("WebSocket连接成功   状态码："+this.websocket.readyState)},setOnmessageMessage:function(t){var e=JSON.parse(t.data);e.users?this.onLine=e.users:(this.$message({type:"success",message:"您有新的消息！内容："+e.msg,center:!0}),this.wsData+=t.data,this.unReadMsg++)},setOncloseMessage:function(){console.log("WebSocket连接关闭   状态码："+this.websocket.readyState)},onbeforeunload:function(){this.websocket.close()}}},l={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("nav",{staticClass:"site-navbar",class:"site-navbar--"+t.navbarLayoutType},[t.sidebarFold?t._e():n("div",{staticClass:"site-navbar__header"},[n("h1",{staticClass:"site-navbar__brand",on:{click:function(e){return t.$router.push({name:"home"})}}},[n("a",{staticClass:"site-navbar__brand-lg",attrs:{href:"javascript:;"}},[t._v("微同软件管理平台")])])]),t._v(" "),n("div",{staticClass:"site-navbar__body clearfix"},[n("el-menu",{staticClass:"site-navbar__menu",attrs:{mode:"horizontal"}},[n("el-menu-item",{staticClass:"site-navbar__switch",attrs:{index:"0"},on:{click:function(e){t.sidebarFold=!t.sidebarFold}}},[n("icon-svg",{attrs:{name:"zhedie"}})],1)],1),t._v(" "),n("el-menu",{staticClass:"site-navbar__menu site-navbar__menu--right",attrs:{mode:"horizontal"}},[n("el-menu-item",{attrs:{index:"0"},on:{click:t.openKefu}},[n("template",{slot:"title"},[n("el-badge",{attrs:{value:t.unReadMsg}},[n("icon-svg",{staticClass:"el-icon-setting",attrs:{name:"wechat"}})],1)],1)],2),t._v(" "),n("el-menu-item",{attrs:{index:"1"}},[n("el-badge",{attrs:{value:"hot"}},[n("a",{attrs:{href:"//fly2you.cn/",target:"_blank"}},[t._v("官方社区")])])],1),t._v(" "),n("el-menu-item",{attrs:{index:"2"},on:{click:function(e){return t.$router.push({name:"theme"})}}},[n("template",{slot:"title"},[n("el-badge",{attrs:{"is-dot":"",value:"new"}},[n("icon-svg",{staticClass:"el-icon-setting",attrs:{name:"xitongpeizhi"}})],1)],1)],2),t._v(" "),n("el-menu-item",{staticClass:"site-navbar__avatar",attrs:{index:"3"}},[n("el-dropdown",{attrs:{"show-timeout":0,placement:"bottom"}},[n("span",{staticClass:"el-dropdown-link"},[n("img",{attrs:{src:s("zQrT"),alt:t.userName}}),t._v(t._s(t.userName)+"\n          ")]),t._v(" "),n("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[n("el-dropdown-item",{nativeOn:{click:function(e){return t.updatePasswordHandle()}}},[t._v("修改密码")]),t._v(" "),n("el-dropdown-item",{nativeOn:{click:function(e){return t.logoutHandle()}}},[t._v("退出")])],1)],1)],1)],1)],1),t._v(" "),t.updatePassowrdVisible?n("update-password",{ref:"updatePassowrd"}):t._e(),t._v(" "),n("el-dialog",{attrs:{"close-on-click-modal":!1,title:"客服消息",visible:t.kefuVisible,"append-to-body":!0},on:{"update:visible":function(e){t.kefuVisible=e}}},[n("div",{staticStyle:{height:"300px","overflow-y":"auto","background-color":"#EDEDED"}},[t._v("\n      "+t._s(t.wsData)+"\n    ")]),t._v("\n    发送用户："),n("br"),t._v(" "),n("el-select",{attrs:{multiple:"",placeholder:"请选择"},model:{value:t.to,callback:function(e){t.to=e},expression:"to"}},t._l(t.onLine,function(t){return n("el-option",{key:t.userId,attrs:{label:t.userName,value:t.userId}})}),1),t._v(" "),n("br"),t._v("发送内容：\n    "),n("el-input",{attrs:{placeholder:"请输入内容"},model:{value:t.msg,callback:function(e){t.msg=e},expression:"msg"}}),t._v(" "),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{type:"success"},on:{click:t.sendAll}},[t._v("群发")]),t._v(" "),n("el-button",{attrs:{type:"warning"},on:{click:t.sendToUser}},[t._v("指定用户")]),t._v(" "),n("el-button",{on:{click:function(e){t.kefuVisible=!1}}},[t._v("取消")])],1)],1)],1)},staticRenderFns:[]},c=s("VU/8")(r,l,!1,null,null,null);e.default=c.exports},zQrT:function(t,e,s){t.exports=s.p+"static/img/avatar.68ce495.png"}});